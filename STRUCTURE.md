# Codebase Structure

**Analysis Date:** 2026-02-11

## Directory Layout

```
lwc-inventory/
├── app/                          # Main application package
│   ├── __init__.py              # Application factory (create_app)
│   ├── extensions.py            # Flask extension initialization
│   ├── auth/                    # Authentication module
│   ├── admin/                   # Admin panel module
│   ├── dashboard/               # Dashboard module
│   ├── inventory/               # Inventory management module
│   ├── items/                   # Items CRUD module
│   ├── jobs/                    # Jobs and staging module
│   ├── audit/                   # Audit logging module
│   ├── models/                  # SQLAlchemy models
│   ├── services/                # Business logic services
│   ├── utils/                   # Utility functions and decorators
│   ├── static/                  # Static assets (CSS, JS, images)
│   └── templates/               # Jinja2 HTML templates
├── migrations/                  # Alembic database migrations
├── instance/                    # Runtime instance folder (DB, secrets)
├── config.py                    # Flask configuration classes
├── run.py                       # Application entry point
├── requirements.txt             # Python dependencies
├── .env.example                 # Environment variables template
└── .flaskenv                    # Flask-specific env config
```

## Directory Purposes

**app/:**
- Purpose: Root Flask application package containing all production code
- Contains: Models, routes, templates, services, static assets
- Key files: `__init__.py` (app factory), `extensions.py` (initialized extensions)

**app/models/:**
- Purpose: SQLAlchemy ORM model definitions
- Contains: Database table definitions with relationships and properties
- Key files: `user.py`, `item.py`, `job.py`, `transaction.py`, `category.py`, `alert.py`, `setting.py`
- Relationships: Item → Category, Transaction → Item/User, JobMaterial → Job/Item, Alert → Item, AppSetting singleton

**app/services/:**
- Purpose: Business logic and domain services
- Contains: Encapsulated business logic, external API integrations
- Key files: `inventory_service.py` (check-in/check-out), `jobber_service.py` (Jobber API), `alert_service.py` (threshold alerts)

**app/{auth,inventory,jobs,items,admin,dashboard,audit}/:**
- Purpose: Feature modules organized as Flask blueprints
- Contains: `routes.py` (HTTP handlers), `forms.py` (WTForms), `__init__.py` (blueprint registration)
- Pattern: Each blueprint is self-contained with own routes and forms

**app/templates/:**
- Purpose: Jinja2 server-side HTML templates
- Contains: Base layout, feature-specific templates, reusable components
- Key files: `base.html` (navigation, layout), `components/_*.html` (modular snippets)
- Organization: Subdirectories mirror blueprint structure (`inventory/`, `jobs/`, `auth/`, etc.)

**app/static/:**
- Purpose: Static client assets
- Contains: CSS stylesheets, JavaScript, images
- Key files: `css/style.css` (custom styles), `js/app.js` (client-side logic), `img/` (logo, icons)

**app/utils/:**
- Purpose: Shared utilities and helpers
- Contains: Database seeding, decorators, helper functions
- Key files: `seed.py` (populate test data), `decorators.py` (custom route decorators)

**migrations/:**
- Purpose: Alembic database schema migrations
- Contains: Version-controlled schema changes
- Key files: `env.py` (migration config), `versions/` (migration scripts)
- Auto-generated by `flask db migrate` and applied via `flask db upgrade`

**instance/:**
- Purpose: Runtime instance folder (Git-ignored)
- Contains: SQLite database file (`lwc_inventory.db`), local configuration
- Generated: Automatically created by app, contains live data

**config.py:**
- Purpose: Environment-specific Flask configuration
- Contains: Config classes (BaseConfig, DevelopmentConfig, ProductionConfig, TestingConfig)
- Key settings: Database URI, mail server, items per page, debug mode

**run.py:**
- Purpose: Application entry point
- Responsibilities: Load .env file, instantiate app, start development server
- Usage: `python run.py`

## Key File Locations

**Entry Points:**
- `run.py`: Development server start point
- `app/__init__.py`: Application factory function `create_app(config_class)`
- `app/extensions.py`: Extension initialization (db, migrate, login_manager, csrf, mail)

**Configuration:**
- `config.py`: Flask environment configurations (development, production, testing)
- `.env`: Environment variables (not committed, see `.env.example`)
- `.flaskenv`: Flask-specific environment variables

**Core Logic:**
- `app/services/inventory_service.py`: Check-in/check-out transaction handling
- `app/services/jobber_service.py`: Jobber API integration and OAuth flow
- `app/services/alert_service.py`: Inventory threshold monitoring

**Models & Database:**
- `app/models/__init__.py`: Model exports
- `app/models/item.py`: Item with quantity and threshold logic
- `app/models/job.py`: Job and JobMaterial entities
- `app/models/user.py`: User with roles and authentication
- `app/models/transaction.py`: Inventory movement audit log
- `migrations/`: Database schema versions

**Routes & Controllers:**
- `app/inventory/routes.py`: Inventory check-in/check-out, listing
- `app/jobs/routes.py`: Job listing, staging, material picking
- `app/items/routes.py`: Item CRUD operations
- `app/auth/routes.py`: Login, logout
- `app/admin/routes.py`: User management, settings, integrations
- `app/dashboard/routes.py`: Dashboard overview
- `app/audit/routes.py`: Transaction history

**Views & Templates:**
- `app/templates/base.html`: Navigation bar, main layout, flash messages
- `app/templates/inventory/`: Check-in/check-out forms, item listing
- `app/templates/jobs/`: Job list, detail, staging view
- `app/templates/auth/login.html`: Login form
- `app/templates/components/`: Reusable modal, pagination, alert banner components

**Forms:**
- `app/inventory/forms.py`: CheckInForm, CheckOutForm
- `app/jobs/forms.py`: Job forms
- `app/items/forms.py`: Item forms
- `app/auth/forms.py`: LoginForm
- `app/admin/forms.py`: User and settings forms

## Naming Conventions

**Files:**
- Models: singular, lowercase (`item.py`, `user.py`, `job.py`)
- Routes: plural, lowercase (`routes.py`)
- Services: singular with `_service` suffix (`inventory_service.py`, `jobber_service.py`)
- Templates: lowercase with underscores for components (`_alert_banner.html`, `_pagination.html`)
- Forms: plural, lowercase (`forms.py`)

**Directories:**
- Blueprints: plural, lowercase (`auth`, `inventory`, `jobs`, `items`, `admin`, `audit`, `dashboard`)
- Model package: `models`
- Service package: `services`
- Utility package: `utils`
- Template subdirectories: match blueprint names or component groups

**Classes:**
- Models: PascalCase (`User`, `Item`, `Job`, `JobMaterial`)
- Forms: PascalCase ending in "Form" (`LoginForm`, `CheckInForm`, `CheckOutForm`)
- Blueprints: lowercase with `_bp` suffix in `__init__.py`

**Functions/Methods:**
- Route handlers: snake_case, descriptive (`check_in`, `check_out`, `list`, `detail`)
- Service functions: snake_case (`check_in`, `check_out`, `refresh_access_token`, `is_connected`)
- Model properties: snake_case using `@property` decorator (`is_below_threshold`, `stock_status`, `pick_progress`)
- Template filters: snake_case if custom

**Variables:**
- Flask config: UPPERCASE (`SECRET_KEY`, `SQLALCHEMY_DATABASE_URI`, `ITEMS_PER_PAGE`)
- Instance variables: snake_case (`current_user`, `quantity_on_hand`, `scheduled_date`)
- Database columns: snake_case (`created_at`, `updated_at`, `is_active`)

## Where to Add New Code

**New Feature (complete blueprint):**
- Primary code: `app/{feature_name}/` directory with `__init__.py`, `routes.py`, `forms.py`
- Routes: Define in `routes.py` with `@blueprint.route()` decorator
- Forms: Define in `forms.py` as WTForms classes
- Blueprint registration: Add in `app/__init__.py` under blueprint registration section (lines 19-39)
- Templates: Create `app/templates/{feature_name}/` subdirectory
- Services: If needed, add to `app/services/`

**New Model:**
- Implementation: Add class to appropriate file in `app/models/` (new file if complex, e.g., `app/models/new_model.py`)
- Export: Add import and `__all__` entry in `app/models/__init__.py`
- Migration: Run `flask db migrate -m "Add new model"` then `flask db upgrade`
- Relationships: Define `db.relationship()` on parent model if needed

**New Service:**
- Implementation: Create `app/services/{service_name}_service.py`
- Pattern: Use module-level functions taking models and returning results
- Database: Use `app.extensions.db` for session access
- External APIs: Follow `jobber_service.py` pattern with token management

**New Route Handler:**
- Implementation: Add function to appropriate `app/{blueprint}/routes.py`
- Decorator: Use `@{blueprint_name}_bp.route('/path', methods=['GET', 'POST'])`
- Authentication: Add `@login_required` if user must be logged in
- Template: Create in `app/templates/{blueprint}/`
- Form usage: Validate with `form.validate_on_submit()` if form-based

**Utilities & Helpers:**
- Shared helpers: `app/utils/` (e.g., `seed.py` for data generation)
- Route decorators: `app/utils/decorators.py` (e.g., role checking)
- Model utilities: Add as `@property` or `@staticmethod` on model class

**Database Seeds:**
- Location: `app/utils/seed.py`
- Registration: Already registered in `app/__init__.py` via `register_seed_command()`
- Usage: `flask seed` runs seeding logic

## Special Directories

**instance/:**
- Purpose: Runtime data and local configuration
- Generated: Automatically created by application
- Committed: No (in .gitignore)
- Contains: SQLite database (`lwc_inventory.db`), instance-specific configs

**migrations/:**
- Purpose: Database schema version control
- Generated: Partially (versions auto-generated by Alembic)
- Committed: Yes (except instance-specific migrations)
- Alembic auto-upgrade: `flask db migrate -m "message"` creates new version, `flask db upgrade` applies

**static/:**
- Purpose: Client-served assets (CSS, JS, images)
- Generated: No (manually maintained)
- Committed: Yes
- Flask serves from: `url_for('static', filename='...')`

**templates/:**
- Purpose: Server-rendered HTML views
- Generated: No (manually maintained)
- Committed: Yes
- Inheritance: All extend `base.html`

---

*Structure analysis: 2026-02-11*
