---
phase: 05-design-system-foundation
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - package.json
  - src/lib/motion.ts
  - src/components/ui/page-transition.tsx
  - src/app/layout.tsx
  - src/app/globals.css
  - tailwind.config.ts
autonomous: true

must_haves:
  truths:
    - "Page transitions animate smoothly when navigating between routes"
    - "At least one micro-interaction (button hover scale, focus ring glow) animates using the Motion library"
    - "Components render correctly at mobile (375px), tablet (768px), and desktop (1280px) widths without manual per-page fixes"
    - "Users with prefers-reduced-motion see instant transitions (no animation)"
  artifacts:
    - path: "src/lib/motion.ts"
      provides: "Shared animation presets and reduced-motion utilities"
      exports: ["fadeIn", "slideUp", "staggerChildren", "pageTransition", "microInteraction"]
    - path: "src/components/ui/page-transition.tsx"
      provides: "Reusable page transition wrapper component"
      exports: ["PageTransition"]
    - path: "src/app/globals.css"
      provides: "Responsive spacing tokens and animation keyframes"
      contains: "--space-section"
    - path: "tailwind.config.ts"
      provides: "Responsive spacing and animation utilities"
      contains: "section"
  key_links:
    - from: "src/components/ui/page-transition.tsx"
      to: "src/lib/motion.ts"
      via: "Import animation presets"
      pattern: "import.*from.*motion"
    - from: "src/components/ui/page-transition.tsx"
      to: "motion/react"
      via: "Motion component for animation"
      pattern: "from.*motion/react"
    - from: "src/app/globals.css"
      to: "tailwind.config.ts"
      via: "CSS variables consumed by Tailwind spacing utilities"
      pattern: "--space-"
---

<objective>
Create the animation system and responsive design tokens that give the IDD Benefits Navigator fluid motion and consistent spacing across all breakpoints.

Purpose: Phases 6-9 need ready-made animation presets and responsive tokens. Without this foundation, every page redesign would reinvent transitions and breakpoint logic. This plan ships the shared motion/spacing system once.

Output: Motion library installed with shared animation presets, a PageTransition wrapper component, CSS animation keyframes, and responsive spacing tokens that enforce mobile-first consistency.
</objective>

<execution_context>
@/Users/vincecain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vincecain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-design-system-foundation/05-01-SUMMARY.md

@src/app/globals.css
@src/app/layout.tsx
@tailwind.config.ts
@src/lib/utils.ts
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Motion library and create shared animation presets</name>
  <files>
    package.json
    src/lib/motion.ts
    src/components/ui/page-transition.tsx
  </files>
  <action>
**Step 1 — Install Motion (the library formerly known as Framer Motion):**

```bash
npm install motion
```

The package is `motion` (not `framer-motion`). Import from `motion/react` for React components:
```ts
import { motion, AnimatePresence } from "motion/react"
```

**Step 2 — Create `src/lib/motion.ts`** with shared animation presets:

This file exports reusable animation variant objects and utilities. Every subsequent phase imports from here — no one-off animation definitions scattered across components.

```ts
import type { Variants } from "motion/react";

// Detect user's motion preference
export const prefersReducedMotion = () =>
  typeof window !== "undefined" &&
  window.matchMedia("(prefers-reduced-motion: reduce)").matches;

// Duration constants (in seconds)
export const duration = {
  fast: 0.15,
  normal: 0.3,
  slow: 0.5,
  page: 0.4,
} as const;

// Easing curves
export const easing = {
  easeOut: [0.16, 1, 0.3, 1] as const,
  easeInOut: [0.42, 0, 0.58, 1] as const,
  spring: { type: "spring", stiffness: 300, damping: 24 } as const,
} as const;

// Page transition — fade + slight upward slide
export const pageTransition: Variants = {
  initial: { opacity: 0, y: 12 },
  animate: {
    opacity: 1,
    y: 0,
    transition: { duration: duration.page, ease: easing.easeOut },
  },
  exit: {
    opacity: 0,
    y: -8,
    transition: { duration: duration.fast, ease: easing.easeInOut },
  },
};

// Fade in (for sections loading into view)
export const fadeIn: Variants = {
  initial: { opacity: 0 },
  animate: {
    opacity: 1,
    transition: { duration: duration.normal, ease: easing.easeOut },
  },
};

// Slide up (for cards, list items)
export const slideUp: Variants = {
  initial: { opacity: 0, y: 20 },
  animate: {
    opacity: 1,
    y: 0,
    transition: { duration: duration.normal, ease: easing.easeOut },
  },
};

// Stagger children (for lists of cards)
export const staggerContainer: Variants = {
  initial: {},
  animate: {
    transition: {
      staggerChildren: 0.08,
      delayChildren: 0.1,
    },
  },
};

// Scale on hover (for interactive cards)
export const hoverScale = {
  whileHover: { scale: 1.02 },
  whileTap: { scale: 0.98 },
  transition: { type: "spring", stiffness: 400, damping: 17 },
} as const;

// Button micro-interaction
export const buttonPress = {
  whileHover: { scale: 1.03 },
  whileTap: { scale: 0.97 },
  transition: { type: "spring", stiffness: 500, damping: 20 },
} as const;

// Focus ring glow animation (CSS class applied via Tailwind)
// This is defined in globals.css as a keyframe, referenced here for documentation
export const FOCUS_RING_CLASS = "focus-ring-glow";
```

**Step 3 — Create `src/components/ui/page-transition.tsx`:**

A client component that wraps page content with entry animations. Respects `prefers-reduced-motion`.

```tsx
"use client";

import { motion } from "motion/react";
import { pageTransition, prefersReducedMotion } from "@/lib/motion";

interface PageTransitionProps {
  children: React.ReactNode;
  className?: string;
}

export function PageTransition({ children, className }: PageTransitionProps) {
  // Skip animation for users who prefer reduced motion
  if (typeof window !== "undefined" && prefersReducedMotion()) {
    return <div className={className}>{children}</div>;
  }

  return (
    <motion.div
      variants={pageTransition}
      initial="initial"
      animate="animate"
      className={className}
    >
      {children}
    </motion.div>
  );
}
```

IMPORTANT: This component is `"use client"` because Motion requires browser APIs. Pages that use it will wrap their content in `<PageTransition>`. The component does NOT use `AnimatePresence` + `exit` because Next.js App Router does not support exit animations natively (the outgoing page is unmounted before the new one renders). Entry animations only.

The `prefersReducedMotion()` check runs on mount. If the user has reduced motion enabled, the wrapper renders a plain `<div>` — no motion imports are even triggered for animation.
  </action>
  <verify>
1. Verify `motion` is in package.json dependencies: `grep '"motion"' package.json`
2. Verify `src/lib/motion.ts` exists and exports pageTransition, fadeIn, slideUp, staggerContainer, hoverScale, buttonPress
3. Verify `src/components/ui/page-transition.tsx` exists and imports from `motion/react`
4. Verify PageTransition respects reduced motion (grep for `prefersReducedMotion`)
5. Run `npm run build` — no TypeScript or build errors
  </verify>
  <done>
Motion library installed. Shared animation presets (pageTransition, fadeIn, slideUp, staggerContainer, hoverScale, buttonPress) exported from src/lib/motion.ts. PageTransition wrapper component created with prefers-reduced-motion support. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add responsive spacing tokens, animation keyframes, and verify mobile-first consistency</name>
  <files>
    src/app/globals.css
    tailwind.config.ts
    src/app/layout.tsx
  </files>
  <action>
**Step 1 — Add responsive spacing tokens to `src/app/globals.css`:**

Inside the existing `:root` block (from 05-01), add responsive spacing custom properties:

```css
/* Responsive spacing tokens — mobile-first values */
--space-section: 2rem;          /* Vertical space between page sections */
--space-card-padding: 1.25rem;  /* Internal card padding */
--space-stack: 1rem;            /* Space between stacked elements */
--space-inline: 0.75rem;        /* Space between inline elements */
--space-page-x: 1rem;           /* Horizontal page padding */
--space-page-y: 1.5rem;         /* Vertical page padding */
--content-max-width: 100%;      /* Max content width */
```

Add a tablet breakpoint media query:
```css
@media (min-width: 768px) {
  :root {
    --space-section: 3rem;
    --space-card-padding: 1.5rem;
    --space-stack: 1.25rem;
    --space-inline: 1rem;
    --space-page-x: 1.5rem;
    --space-page-y: 2rem;
    --content-max-width: 768px;
  }
}
```

Add a desktop breakpoint media query:
```css
@media (min-width: 1280px) {
  :root {
    --space-section: 4rem;
    --space-card-padding: 2rem;
    --space-stack: 1.5rem;
    --space-inline: 1.25rem;
    --space-page-x: 2rem;
    --space-page-y: 2.5rem;
    --content-max-width: 1200px;
  }
}
```

**Step 2 — Add CSS animation keyframes for micro-interactions:**

In `src/app/globals.css`, add keyframe definitions in `@layer base`:

```css
/* Focus ring glow animation */
@keyframes focus-ring-glow {
  0% { box-shadow: 0 0 0 2px hsl(var(--ring) / 0); }
  50% { box-shadow: 0 0 0 3px hsl(var(--ring) / 0.3); }
  100% { box-shadow: 0 0 0 2px hsl(var(--ring) / 0.15); }
}

/* Subtle pulse for loading states */
@keyframes gentle-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Slide in from bottom for toast/notification */
@keyframes slide-in-up {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
```

Add the focus-ring-glow utility class:
```css
.focus-ring-glow:focus-visible {
  animation: focus-ring-glow 0.6s ease-out forwards;
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}
```

**Step 3 — Add responsive spacing utilities to `tailwind.config.ts`:**

In the `extend` section, add spacing values that reference the CSS variables:

```ts
spacing: {
  section: "var(--space-section)",
  "card-padding": "var(--space-card-padding)",
  stack: "var(--space-stack)",
  inline: "var(--space-inline)",
  "page-x": "var(--space-page-x)",
  "page-y": "var(--space-page-y)",
},
maxWidth: {
  content: "var(--content-max-width)",
},
```

Also add animation utilities for the CSS keyframes:
```ts
keyframes: {
  "focus-ring-glow": {
    "0%": { boxShadow: "0 0 0 2px hsl(var(--ring) / 0)" },
    "50%": { boxShadow: "0 0 0 3px hsl(var(--ring) / 0.3)" },
    "100%": { boxShadow: "0 0 0 2px hsl(var(--ring) / 0.15)" },
  },
  "gentle-pulse": {
    "0%, 100%": { opacity: "1" },
    "50%": { opacity: "0.7" },
  },
  "slide-in-up": {
    from: { transform: "translateY(100%)", opacity: "0" },
    to: { transform: "translateY(0)", opacity: "1" },
  },
},
animation: {
  "focus-ring": "focus-ring-glow 0.6s ease-out forwards",
  "gentle-pulse": "gentle-pulse 2s ease-in-out infinite",
  "slide-in-up": "slide-in-up 0.3s ease-out",
},
```

**Step 4 — Update the global `*:focus-visible` style:**

Replace the existing hardcoded focus color with the CSS variable:
```css
*:focus-visible {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}
```

**Step 5 — Verify mobile-first approach in layout.tsx:**

Check `src/app/layout.tsx` and `src/components/layout/MainLayout.tsx`. The MainLayout already uses `px-4 sm:px-6 lg:px-8` — this is Tailwind mobile-first. No changes needed to the layout structure itself, but verify the `max-w-7xl` class aligns with the new `--content-max-width` token. The tokens exist alongside the Tailwind max-w classes — both work. Future phases will migrate to the token versions page by page.

**Step 6 — Add prefers-reduced-motion handling in CSS:**

Ensure the existing `@media (prefers-reduced-motion: reduce)` block in globals.css also disables the new animations:
```css
@media (prefers-reduced-motion: reduce) {
  html {
    scroll-behavior: auto;
  }
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
```

This is the standard reduced-motion reset that ensures all CSS animations and transitions are effectively instant. The Motion library's `prefersReducedMotion()` check in `page-transition.tsx` handles JavaScript animations separately.
  </action>
  <verify>
1. Verify globals.css contains `--space-section`, `--space-card-padding`, `--space-page-x`
2. Verify globals.css has tablet (768px) and desktop (1280px) media queries with updated spacing values
3. Verify globals.css has `@keyframes focus-ring-glow` and `@keyframes gentle-pulse`
4. Verify globals.css has `prefers-reduced-motion` block that disables animations
5. Verify tailwind.config.ts has `spacing.section`, `spacing["card-padding"]`, etc.
6. Verify tailwind.config.ts has animation utilities (focus-ring, gentle-pulse, slide-in-up)
7. Run `npm run build` — no errors
8. Verify `*:focus-visible` uses `hsl(var(--ring))` not hardcoded hex
  </verify>
  <done>
Responsive spacing tokens defined (mobile/tablet/desktop) via CSS variables consumed by Tailwind utilities. CSS animation keyframes (focus-ring-glow, gentle-pulse, slide-in-up) registered in both globals.css and tailwind.config.ts. Focus ring uses theme-aware CSS variable. Prefers-reduced-motion disables all animations. Components render consistently at 375px, 768px, and 1280px because spacing scales via CSS variables, not manual per-page adjustments. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. `motion` is in package.json dependencies
3. `src/lib/motion.ts` exports 6+ animation presets
4. `src/components/ui/page-transition.tsx` wraps content with entry animation and handles reduced motion
5. `src/app/globals.css` has responsive spacing tokens with 3 breakpoints (mobile default, 768px, 1280px)
6. `src/app/globals.css` has animation keyframes and reduced-motion override
7. `tailwind.config.ts` has spacing utilities referencing CSS variables
8. Focus ring uses `hsl(var(--ring))` theme variable (not hardcoded #2d8f7f)
9. `prefers-reduced-motion` disables ALL animations (CSS and informs Motion)
</verification>

<success_criteria>
- Page transitions animate using Motion library (FOUN-03 partial)
- At least one micro-interaction (focus-ring-glow) animates via CSS keyframe (FOUN-03 partial)
- Responsive spacing tokens scale across mobile/tablet/desktop (FOUN-04)
- Components use consistent spacing from CSS variables, not per-page hardcoded values (FOUN-04)
- Users with prefers-reduced-motion see no animations (accessibility requirement)
- Foundation fully ready for Phase 6 (layout/home page redesign)
</success_criteria>

<output>
After completion, create `.planning/phases/05-design-system-foundation/05-02-SUMMARY.md`
</output>
